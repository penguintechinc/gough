[tool:pytest]
# Pytest configuration for Gough hypervisor testing
minversion = 6.0
addopts = 
    -ra
    --strict-markers
    --strict-config
    --cov=gough
    --cov-report=term-missing:skip-covered
    --cov-report=html:tests/reports/coverage_html
    --cov-report=xml:tests/reports/coverage.xml
    --cov-report=json:tests/reports/coverage.json
    --html=tests/reports/pytest_report.html
    --self-contained-html
    --json-report
    --json-report-file=tests/reports/pytest_report.json
    --timeout=300
    --maxfail=5
    -v

testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, external dependencies)
    performance: Performance and load tests
    e2e: End-to-end tests
    slow: Slow running tests
    maas: MaaS related tests
    ansible: Ansible related tests
    fleetdm: FleetDM related tests
    agent: Agent related tests
    cloud_init: Cloud-init template tests
    database: Database related tests
    api: API endpoint tests
    auth: Authentication tests
    deployment: Deployment workflow tests
    monitoring: Monitoring and alerting tests

filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

env = 
    TESTING = 1
    LOG_LEVEL = DEBUG
    DATABASE_URL = postgresql://test_user:test_pass@localhost:5432/test_gough
    REDIS_URL = redis://localhost:6379/1
    MAAS_URL = http://localhost:5240/MAAS/
    FLEET_URL = http://localhost:8080
    DISABLE_AUTH = 1

asyncio_mode = auto
timeout = 300

# Coverage configuration
[coverage:run]
source = gough
omit = 
    */tests/*
    */migrations/*
    */venv/*
    */env/*
    */__pycache__/*
    */site-packages/*
    setup.py
    */fixtures/*
    */mocks/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\(Protocol\):
    @(abc\.)?abstractmethod

precision = 2
show_missing = True
skip_covered = False
sort = Cover

[coverage:html]
directory = tests/reports/coverage_html

[coverage:xml]
output = tests/reports/coverage.xml

[coverage:json]
output = tests/reports/coverage.json