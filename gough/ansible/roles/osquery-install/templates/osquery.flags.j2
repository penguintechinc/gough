# OSQuery flags configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# Fleet DM TLS configuration
--tls_server_certs={{ osquery_config_path }}/certs/ca-certificates.crt
--tls_hostname={{ fleet_server_url | regex_replace('^https?://([^/:]+).*', '\\1') }}

# Enrollment configuration
--enroll_secret_path={{ osquery_config_path }}/enroll_secret
--enroll_tls_endpoint={{ fleet_server_url }}/api/osquery/enroll

# Configuration endpoints
--config_plugin=tls
--config_tls_endpoint={{ fleet_server_url }}/api/osquery/config
--config_refresh=10

# Logging configuration
--logger_plugin=tls
--logger_tls_endpoint={{ fleet_server_url }}/api/osquery/log
--logger_tls_period=10
--logger_tls_compress=true

# Distributed query configuration
--disable_distributed=false
--distributed_plugin=tls
--distributed_interval=10
--distributed_tls_max_attempts=3
--distributed_tls_read_endpoint={{ fleet_server_url }}/api/osquery/distributed/read
--distributed_tls_write_endpoint={{ fleet_server_url }}/api/osquery/distributed/write

# Carver configuration
--carver_start_endpoint={{ fleet_server_url }}/api/osquery/carve/begin
--carver_continue_endpoint={{ fleet_server_url }}/api/osquery/carve/block
--carver_block_size=2000000
--carver_compression=true

# Host identification
--host_identifier=uuid
--schedule_splay_percent=10

# Logging and monitoring
--verbose={{ verbose | lower }}
--logger_snapshot_event_type=true
--disable_events=false
--events_expiry=3600
--worker_threads=2
--enable_monitor=true

# Performance and resource limits
--enable_numeric_monitoring=true
--numeric_monitoring_filesystem_path=/var/log/osquery/
--watchdog_level=0
--watchdog_memory_limit=1024
--watchdog_utilization_limit=90

# Security settings
--disable_audit=false
--audit_allow_config=true
--audit_allow_sockets=true

# Database settings
--database_path=/var/osquery/osquery.db
--database_dump=false

# Logging settings
--logger_path=/var/log/osquery/
--log_result_events=true
--log_numerics=false